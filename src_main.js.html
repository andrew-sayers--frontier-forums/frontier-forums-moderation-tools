<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: src/main.js</title>


    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">


    <script>
    var config = {"monospaceLinks":false,"cleverLinks":true,"default":{"outputSourceFiles":true}};
    </script>



</head>
<body>
<div id="wrap" class="clearfix">

<div class="navigation">
    <h3 class="applicationName"><a href="index.html"></a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">

        <li class="item" data-name="Action">
            <span class="title">
                <a href="Action.html">Action</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="Action#blockers"><a href="Action.html#blockers">blockers</a></li>

                <li data-name="Action#fire"><a href="Action.html#fire">fire</a></li>

                <li data-name="Action#fire_with_journal"><a href="Action.html#fire_with_journal">fire_with_journal</a></li>

                <li data-name="Action#long_description"><a href="Action.html#long_description">long_description</a></li>

                <li data-name="Action#then"><a href="Action.html#then">then</a></li>

                <li data-name="Action#title"><a href="Action.html#title">title</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="ActionWidget">
            <span class="title">
                <a href="ActionWidget.html">ActionWidget</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="ActionWidget#action"><a href="ActionWidget.html#action">action</a></li>

                <li data-name="ActionWidget#val"><a href="ActionWidget.html#val">val</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="AvailableUsers">
            <span class="title">
                <a href="AvailableUsers.html">AvailableUsers</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="AvailableUsers#active"><a href="AvailableUsers.html#active">active</a></li>

                <li data-name="AvailableUsers#is_ours"><a href="AvailableUsers.html#is_ours">is_ours</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="BulletinBoard">
            <span class="title">
                <a href="BulletinBoard.html">BulletinBoard</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="BulletinBoard#_add_standard_data"><a href="BulletinBoard.html#_add_standard_data">_add_standard_data</a></li>

                <li data-name="BulletinBoard#build_url"><a href="BulletinBoard.html#build_url">build_url</a></li>

                <li data-name="BulletinBoard#config"><a href="BulletinBoard.html#config">config</a></li>

                <li data-name="BulletinBoard#detect_post_error"><a href="BulletinBoard.html#detect_post_error">detect_post_error</a></li>

                <li data-name="BulletinBoard#get"><a href="BulletinBoard.html#get">get</a></li>

                <li data-name="BulletinBoard#get_pages"><a href="BulletinBoard.html#get_pages">get_pages</a></li>

                <li data-name="BulletinBoard#get_posts"><a href="BulletinBoard.html#get_posts">get_posts</a></li>

                <li data-name="BulletinBoard#parse"><a href="BulletinBoard.html#parse">parse</a></li>

                <li data-name="BulletinBoard#ping"><a href="BulletinBoard.html#ping">ping</a></li>

                <li data-name="BulletinBoard#post"><a href="BulletinBoard.html#post">post</a></li>

                <li data-name="BulletinBoard#process_posts"><a href="BulletinBoard.html#process_posts">process_posts</a></li>

                <li data-name="BulletinBoard#quotes_process"><a href="BulletinBoard.html#quotes_process">quotes_process</a></li>

                <li data-name="BulletinBoard#stringify"><a href="BulletinBoard.html#stringify">stringify</a></li>

                <li data-name="BulletinBoard#thread_posts"><a href="BulletinBoard.html#thread_posts">thread_posts</a></li>

                <li data-name="BulletinBoard#when"><a href="BulletinBoard.html#when">when</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="Cacheable">
            <span class="title">
                <a href="Cacheable.html">Cacheable</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="Cacheable#refresh"><a href="Cacheable.html#refresh">refresh</a></li>

                <li data-name="Cacheable#update_cache"><a href="Cacheable.html#update_cache">update_cache</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="Dashboard">
            <span class="title">
                <a href="Dashboard.html">Dashboard</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="Dashboard#refresh"><a href="Dashboard.html#refresh">refresh</a></li>

                <li data-name="Dashboard#update_cache"><a href="Dashboard.html#update_cache">update_cache</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="DuplicateAccountList">
            <span class="title">
                <a href="DuplicateAccountList.html">DuplicateAccountList</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="DuplicateAccountList#val"><a href="DuplicateAccountList.html#val">val</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="EmailHighlighter">
            <span class="title">
                <a href="EmailHighlighter.html">EmailHighlighter</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="EmailHighlighter#highlight"><a href="EmailHighlighter.html#highlight">highlight</a></li>

                <li data-name="EmailHighlighter#highlight_to_element"><a href="EmailHighlighter.html#highlight_to_element">highlight_to_element</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="ExtraPost">
            <span class="title">
                <a href="ExtraPost.html">ExtraPost</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="ExtraPost#action"><a href="ExtraPost.html#action">action</a></li>

                <li data-name="ExtraPost#val"><a href="ExtraPost.html#val">val</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="IPAddressReport">
            <span class="title">
                <a href="IPAddressReport.html">IPAddressReport</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="IPAddressReport#action"><a href="IPAddressReport.html#action">action</a></li>

                <li data-name="IPAddressReport#bbcode"><a href="IPAddressReport.html#bbcode">bbcode</a></li>

                <li data-name="IPAddressReport#cache_timeout"><a href="IPAddressReport.html#cache_timeout">cache_timeout</a></li>

                <li data-name="IPAddressReport#html"><a href="IPAddressReport.html#html">html</a></li>

                <li data-name="IPAddressReport#users"><a href="IPAddressReport.html#users">users</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="MiscellaneousCache">
            <span class="title">
                <a href="MiscellaneousCache.html">MiscellaneousCache</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="MiscellaneousCache#refresh"><a href="MiscellaneousCache.html#refresh">refresh</a></li>

                <li data-name="MiscellaneousCache#update_cache"><a href="MiscellaneousCache.html#update_cache">update_cache</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="NewbiePolicy">
            <span class="title">
                <a href="NewbiePolicy.html">NewbiePolicy</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="NewbiePolicy#_action_wrapper"><a href="NewbiePolicy.html#_action_wrapper">_action_wrapper</a></li>

                <li data-name="NewbiePolicy#action_duplicate_wrapper"><a href="NewbiePolicy.html#action_duplicate_wrapper">action_duplicate_wrapper</a></li>

                <li data-name="NewbiePolicy#action_inappropriate_wrapper"><a href="NewbiePolicy.html#action_inappropriate_wrapper">action_inappropriate_wrapper</a></li>

                <li data-name="NewbiePolicy#extra_post_duplicate"><a href="NewbiePolicy.html#extra_post_duplicate">extra_post_duplicate</a></li>

                <li data-name="NewbiePolicy#extra_post_inappropriate"><a href="NewbiePolicy.html#extra_post_inappropriate">extra_post_inappropriate</a></li>

                <li data-name="NewbiePolicy#fire"><a href="NewbiePolicy.html#fire">fire</a></li>

                <li data-name="NewbiePolicy#get_base_user_id"><a href="NewbiePolicy.html#get_base_user_id">get_base_user_id</a></li>

                <li data-name="NewbiePolicy#notification_selector_duplicate"><a href="NewbiePolicy.html#notification_selector_duplicate">notification_selector_duplicate</a></li>

                <li data-name="NewbiePolicy#notification_selector_inappropriate"><a href="NewbiePolicy.html#notification_selector_inappropriate">notification_selector_inappropriate</a></li>

                <li data-name="NewbiePolicy#set_actions"><a href="NewbiePolicy.html#set_actions">set_actions</a></li>

                <li data-name="NewbiePolicy#severity_slider_duplicate"><a href="NewbiePolicy.html#severity_slider_duplicate">severity_slider_duplicate</a></li>

                <li data-name="NewbiePolicy#severity_slider_inappropriate"><a href="NewbiePolicy.html#severity_slider_inappropriate">severity_slider_inappropriate</a></li>

                <li data-name="NewbiePolicy#suspiciousness_duplicate"><a href="NewbiePolicy.html#suspiciousness_duplicate">suspiciousness_duplicate</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="NotificationSelector">
            <span class="title">
                <a href="NotificationSelector.html">NotificationSelector</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="NotificationSelector#action"><a href="NotificationSelector.html#action">action</a></li>

                <li data-name="NotificationSelector#extra_block"><a href="NotificationSelector.html#extra_block">extra_block</a></li>

                <li data-name="NotificationSelector#mode"><a href="NotificationSelector.html#mode">mode</a></li>

                <li data-name="NotificationSelector#mode_switcher"><a href="NotificationSelector.html#mode_switcher">mode_switcher</a></li>

                <li data-name="NotificationSelector#val"><a href="NotificationSelector.html#val">val</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="Report">
            <span class="title">
                <a href="Report.html">Report</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="SeveritySlider">
            <span class="title">
                <a href="SeveritySlider.html">SeveritySlider</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="SeveritySlider#val"><a href="SeveritySlider.html#val">val</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="SharedStore">
            <span class="title">
                <a href="SharedStore.html">SharedStore</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="SharedStore#change"><a href="SharedStore.html#change">change</a></li>

                <li data-name="SharedStore#interval_transaction"><a href="SharedStore.html#interval_transaction">interval_transaction</a></li>

                <li data-name="SharedStore#transaction"><a href="SharedStore.html#transaction">transaction</a></li>

                <li data-name="SharedStore#val"><a href="SharedStore.html#val">val</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="Variables">
            <span class="title">
                <a href="Variables.html">Variables</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="Variables#check"><a href="Variables.html#check">check</a></li>

                <li data-name="Variables#escape"><a href="Variables.html#escape">escape</a></li>

                <li data-name="Variables#get"><a href="Variables.html#get">get</a></li>

                <li data-name="Variables#get_language"><a href="Variables.html#get_language">get_language</a></li>

                <li data-name="Variables#parse"><a href="Variables.html#parse">parse</a></li>

                <li data-name="Variables#refresh"><a href="Variables.html#refresh">refresh</a></li>

                <li data-name="Variables#resolve"><a href="Variables.html#resolve">resolve</a></li>

                <li data-name="Variables#set_namespaces"><a href="Variables.html#set_namespaces">set_namespaces</a></li>

                <li data-name="Variables#update_cache"><a href="Variables.html#update_cache">update_cache</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="VariablesFromFirstPost">
            <span class="title">
                <a href="VariablesFromFirstPost.html">VariablesFromFirstPost</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="VariablesFromFirstPost#check"><a href="VariablesFromFirstPost.html#check">check</a></li>

                <li data-name="VariablesFromFirstPost#escape"><a href="VariablesFromFirstPost.html#escape">escape</a></li>

                <li data-name="VariablesFromFirstPost#get"><a href="VariablesFromFirstPost.html#get">get</a></li>

                <li data-name="VariablesFromFirstPost#get_language"><a href="VariablesFromFirstPost.html#get_language">get_language</a></li>

                <li data-name="VariablesFromFirstPost#parse"><a href="VariablesFromFirstPost.html#parse">parse</a></li>

                <li data-name="VariablesFromFirstPost#refresh"><a href="VariablesFromFirstPost.html#refresh">refresh</a></li>

                <li data-name="VariablesFromFirstPost#resolve"><a href="VariablesFromFirstPost.html#resolve">resolve</a></li>

                <li data-name="VariablesFromFirstPost#set_namespaces"><a href="VariablesFromFirstPost.html#set_namespaces">set_namespaces</a></li>

                <li data-name="VariablesFromFirstPost#update_cache"><a href="VariablesFromFirstPost.html#update_cache">update_cache</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="VariablesFromForum">
            <span class="title">
                <a href="VariablesFromForum.html">VariablesFromForum</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="VariablesFromForum#check"><a href="VariablesFromForum.html#check">check</a></li>

                <li data-name="VariablesFromForum#escape"><a href="VariablesFromForum.html#escape">escape</a></li>

                <li data-name="VariablesFromForum#get"><a href="VariablesFromForum.html#get">get</a></li>

                <li data-name="VariablesFromForum#get_language"><a href="VariablesFromForum.html#get_language">get_language</a></li>

                <li data-name="VariablesFromForum#parse"><a href="VariablesFromForum.html#parse">parse</a></li>

                <li data-name="VariablesFromForum#refresh"><a href="VariablesFromForum.html#refresh">refresh</a></li>

                <li data-name="VariablesFromForum#refresh_thread"><a href="VariablesFromForum.html#refresh_thread">refresh_thread</a></li>

                <li data-name="VariablesFromForum#resolve"><a href="VariablesFromForum.html#resolve">resolve</a></li>

                <li data-name="VariablesFromForum#set_namespaces"><a href="VariablesFromForum.html#set_namespaces">set_namespaces</a></li>

                <li data-name="VariablesFromForum#update_cache"><a href="VariablesFromForum.html#update_cache">update_cache</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="VBulletin">
            <span class="title">
                <a href="VBulletin.html">VBulletin</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="VBulletin#_add_standard_data"><a href="VBulletin.html#_add_standard_data">_add_standard_data</a></li>

                <li data-name="VBulletin#activity"><a href="VBulletin.html#activity">activity</a></li>

                <li data-name="VBulletin#attachments_delete"><a href="VBulletin.html#attachments_delete">attachments_delete</a></li>

                <li data-name="VBulletin#bbcode_html"><a href="VBulletin.html#bbcode_html">bbcode_html</a></li>

                <li data-name="VBulletin#bbcode_html_newthread"><a href="VBulletin.html#bbcode_html_newthread">bbcode_html_newthread</a></li>

                <li data-name="VBulletin#build_url"><a href="VBulletin.html#build_url">build_url</a></li>

                <li data-name="VBulletin#config"><a href="VBulletin.html#config">config</a></li>

                <li data-name="VBulletin#css_add"><a href="VBulletin.html#css_add">css_add</a></li>

                <li data-name="VBulletin#css_keys"><a href="VBulletin.html#css_keys">css_keys</a></li>

                <li data-name="VBulletin#detect_post_error"><a href="VBulletin.html#detect_post_error">detect_post_error</a></li>

                <li data-name="VBulletin#editor_get"><a href="VBulletin.html#editor_get">editor_get</a></li>

                <li data-name="VBulletin#editor_set"><a href="VBulletin.html#editor_set">editor_set</a></li>

                <li data-name="VBulletin#forum_threads"><a href="VBulletin.html#forum_threads">forum_threads</a></li>

                <li data-name="VBulletin#get"><a href="VBulletin.html#get">get</a></li>

                <li data-name="VBulletin#get_pages"><a href="VBulletin.html#get_pages">get_pages</a></li>

                <li data-name="VBulletin#get_posts"><a href="VBulletin.html#get_posts">get_posts</a></li>

                <li data-name="VBulletin#infraction_give"><a href="VBulletin.html#infraction_give">infraction_give</a></li>

                <li data-name="VBulletin#infraction_give_custom"><a href="VBulletin.html#infraction_give_custom">infraction_give_custom</a></li>

                <li data-name="VBulletin#infraction_ids"><a href="VBulletin.html#infraction_ids">infraction_ids</a></li>

                <li data-name="VBulletin#ip_users"><a href="VBulletin.html#ip_users">ip_users</a></li>

                <li data-name="VBulletin#moderation_page"><a href="VBulletin.html#moderation_page">moderation_page</a></li>

                <li data-name="VBulletin#on_posts_modified"><a href="VBulletin.html#on_posts_modified">on_posts_modified</a></li>

                <li data-name="VBulletin#parse"><a href="VBulletin.html#parse">parse</a></li>

                <li data-name="VBulletin#ping"><a href="VBulletin.html#ping">ping</a></li>

                <li data-name="VBulletin#pm_send"><a href="VBulletin.html#pm_send">pm_send</a></li>

                <li data-name="VBulletin#post"><a href="VBulletin.html#post">post</a></li>

                <li data-name="VBulletin#post_create"><a href="VBulletin.html#post_create">post_create</a></li>

                <li data-name="VBulletin#post_delete"><a href="VBulletin.html#post_delete">post_delete</a></li>

                <li data-name="VBulletin#post_edit"><a href="VBulletin.html#post_edit">post_edit</a></li>

                <li data-name="VBulletin#post_info"><a href="VBulletin.html#post_info">post_info</a></li>

                <li data-name="VBulletin#post_report"><a href="VBulletin.html#post_report">post_report</a></li>

                <li data-name="VBulletin#posts_moderated"><a href="VBulletin.html#posts_moderated">posts_moderated</a></li>

                <li data-name="VBulletin#posts_move"><a href="VBulletin.html#posts_move">posts_move</a></li>

                <li data-name="VBulletin#process_posts"><a href="VBulletin.html#process_posts">process_posts</a></li>

                <li data-name="VBulletin#quotes_process"><a href="VBulletin.html#quotes_process">quotes_process</a></li>

                <li data-name="VBulletin#redirect_modcp_ipsearch"><a href="VBulletin.html#redirect_modcp_ipsearch">redirect_modcp_ipsearch</a></li>

                <li data-name="VBulletin#server_stats"><a href="VBulletin.html#server_stats">server_stats</a></li>

                <li data-name="VBulletin#spammer_delete"><a href="VBulletin.html#spammer_delete">spammer_delete</a></li>

                <li data-name="VBulletin#stringify"><a href="VBulletin.html#stringify">stringify</a></li>

                <li data-name="VBulletin#thread_bump"><a href="VBulletin.html#thread_bump">thread_bump</a></li>

                <li data-name="VBulletin#thread_create"><a href="VBulletin.html#thread_create">thread_create</a></li>

                <li data-name="VBulletin#thread_edit"><a href="VBulletin.html#thread_edit">thread_edit</a></li>

                <li data-name="VBulletin#thread_merge"><a href="VBulletin.html#thread_merge">thread_merge</a></li>

                <li data-name="VBulletin#thread_openclose"><a href="VBulletin.html#thread_openclose">thread_openclose</a></li>

                <li data-name="VBulletin#thread_posts"><a href="VBulletin.html#thread_posts">thread_posts</a></li>

                <li data-name="VBulletin#thread_reply"><a href="VBulletin.html#thread_reply">thread_reply</a></li>

                <li data-name="VBulletin#thread_whoposted"><a href="VBulletin.html#thread_whoposted">thread_whoposted</a></li>

                <li data-name="VBulletin#threads_complete"><a href="VBulletin.html#threads_complete">threads_complete</a></li>

                <li data-name="VBulletin#url_decode"><a href="VBulletin.html#url_decode">url_decode</a></li>

                <li data-name="VBulletin#user_ban"><a href="VBulletin.html#user_ban">user_ban</a></li>

                <li data-name="VBulletin#user_current"><a href="VBulletin.html#user_current">user_current</a></li>

                <li data-name="VBulletin#user_info"><a href="VBulletin.html#user_info">user_info</a></li>

                <li data-name="VBulletin#user_ips"><a href="VBulletin.html#user_ips">user_ips</a></li>

                <li data-name="VBulletin#user_moderation_info"><a href="VBulletin.html#user_moderation_info">user_moderation_info</a></li>

                <li data-name="VBulletin#user_overlapping"><a href="VBulletin.html#user_overlapping">user_overlapping</a></li>

                <li data-name="VBulletin#user_signature_get"><a href="VBulletin.html#user_signature_get">user_signature_get</a></li>

                <li data-name="VBulletin#user_signature_set"><a href="VBulletin.html#user_signature_set">user_signature_set</a></li>

                <li data-name="VBulletin#usernote_add"><a href="VBulletin.html#usernote_add">usernote_add</a></li>

                <li data-name="VBulletin#usernote_edit"><a href="VBulletin.html#usernote_edit">usernote_edit</a></li>

                <li data-name="VBulletin#usernote_info"><a href="VBulletin.html#usernote_info">usernote_info</a></li>

                <li data-name="VBulletin#users_complete"><a href="VBulletin.html#users_complete">users_complete</a></li>

                <li data-name="VBulletin#users_list_new"><a href="VBulletin.html#users_list_new">users_list_new</a></li>

                <li data-name="VBulletin#when"><a href="VBulletin.html#when">when</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="Violations">
            <span class="title">
                <a href="Violations.html">Violations</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="Violations#refresh"><a href="Violations.html#refresh">refresh</a></li>

                <li data-name="Violations#update_cache"><a href="Violations.html#update_cache">update_cache</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

        <li class="item" data-name="Widget">
            <span class="title">
                <a href="Widget.html">Widget</a>

            </span>
            <ul class="members itemMembers">

            </ul>
            <ul class="typedefs itemMembers">

            </ul>
            <ul class="methods itemMembers">

            <span class="subtitle">Methods</span>

                <li data-name="Widget#val"><a href="Widget.html#val">val</a></li>

            </ul>
            <ul class="events itemMembers">

            </ul>
        </li>

    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="src_main.js.html">Source: src/main.js</h1>




    <section>
        <article>
            <pre class="prettyprint source "><code>/**
 * @file Main section for Frontier Forums Moderation Tools
 * @author Andrew Sayers
 */

/*
 * HANDLER SECTIONS
 *
 * The next few blocks handle discrete chunks of the extension process.  They generally look like:
 *
 * function handle_foo( bb, v, ... ) { BabelExt.utils.dispatch( // arguments are bulletin board, variables and anything else needed
 *     { // actions are dispatched on pages that match the criteria
 *         match_pathname: '...',
 *         match_elements: [ ... ],
 *         callback: function(stash, pathname, params) {
 *             // performs the actions relevant to the page
 *         }
 *     },
 *     ... // more actions to dispatch in different circumstances
 * )}
 *
 * They're followed by a main block that initialised the extension then calls each handler in turn.
 *
 */

/**
 * @summary Handle the dashboard page
 * @param {BulletinBoard}      bb Bulletin Board to manipulate
 * @param {Variables}          v  Variables to use
 * @param {Violations}         vi Violations to use
 * @param {SharedStore}        ss Shared Store to use
 * @param {MiscellaneousCache} mc Miscellaneous Cache to use
 * @param {string}        loading_html HTML to show while loading
 */
function handle_dashboard( bb, v, vi, ss, mc, loading_html ) { var au; BabelExt.utils.dispatch(

    {
        match_pathname: '/',
        match_params: {
            do: 'dashboard',
        },
        match_elements: '.welcomelink a',
        pass_preferences: [ 'language' ],
        callback: function( stash, pathname, params, welcome_link, user_language ) {

            stash.replied_thread_id = 0;
            ss.change(function(data) { stash.replied_thread_id = data.intro_forum_thread_id || 0 });

            au = new AvailableUsers({
                ss: ss,
                bb: bb,
                language: user_language
            });
            au.active(true);
        }
    },

    {
        match_pathname: '/',
        match_params: {
            do: 'dashboard',
        },
        match_elements: '.below_body',
        pass_storage: ['dashboard_cache', 'dashboard-newbie-actions'],
        callback: function( stash, pathname, params, below_body, dashboard_cache, dashboard_newbie_actions ) { au.promise.then(function() {

            // Dashboard CSS
            bb.css_add([ 'user_show', 'forum_show', 'thread_show', 'activity' ]);
            $("head").append(
                "&lt;style type='text/css'>" +
                v.parse( BabelExt.resources.get('res/main.css'), bb.css_keys() ) +
                "&lt;/style>"
            );

            var dashboard = $(BabelExt.resources.get('res/dashboard.html'));

            var recently_reported_posts = {};
            var name = $('.welcomelink a').text();

            var mod_log_thread_id = v.resolve('frequently used posts/threads', 'mod log');
            var report_forum_id = 48;
            var introductions_forum_id = 16;
            dashboard.find( '[data-thread="mod-log"]'              ).data( 'thread', mod_log_thread_id );
            dashboard.find( 'a[href="#insert-mod-log-link"]'       ).attr( 'href'  , bb.url_for.thread_show({ thread_id: mod_log_thread_id, goto: 'newpost' }) );
            dashboard.find( '[data-forum="reported-posts"]'        ).data( 'forum' , report_forum_id );
            dashboard.find( 'a[href="#insert-reported-posts-link"]').attr( 'href'  , bb.url_for.forum_show({ forum_id: report_forum_id }) );
            dashboard.find( '[data-forum="introductions"]'         ).data( 'forum' , introductions_forum_id );
            dashboard.find( 'a[href="#insert-introductions-link"]' ).attr( 'href'  , bb.url_for.forum_show({ forum_id: introductions_forum_id }) );
            dashboard.find( 'a[href="#insert-mod-queue-link"]'     ).attr( 'href'  , bb.url_for.moderation_posts() );
            dashboard.find( 'a[href="#insert-newbies-link"]'       ).attr( 'href'  , bb.url_for.users_show() );
            dashboard.find( 'a[href="#insert-activity-link"]'      ).attr( 'href'  , bb.url_for.activity() );


            function progress_bar(button, promise, complete_message) {
                var progress_bar = $(button).parent().addClass('mod-friend-progressing').find('.mod-friend-percent').css({ width: 0 });
                return promise
                    .progress(function(percent) {
                        progress_bar.css({ width: percent + '%' });
                    })
                    .always(function() {
                        progress_bar.closest('.mod-friend-progressing').removeClass('mod-friend-progressing');
                    })
                    .done(function() {
                        $(button)
                            .prop( 'disabled', true ).val( complete_message )
                            .closest('.dashboard-section').find( '.dashboard-done .done').click();;
                    })
                ;
            }

            /*
             * REPORTED POSTS FORUM
             */
            dashboard.find('[data-forum="reported-posts"]').data( 'filter', function(threads) {

                return threads.filter(function(thread) {
                    if ( thread.is_sticky || thread.status != 'open' ) return false;

                    // modify the container elements to make moderation easier
                    $('.threadimod', thread.container_element).remove();

                    $( '.threadstatus', this )
                        .css({ cursor: 'pointer' })
                        .attr( 'title', 'double-click to close this thread' )
                        .dblclick(function() {
                            var threadbit = $(this).closest('.threadbit');
                            bb.thread_openclose( thread.thread_id, $(this).closest('.threadbit').hasClass('lock') )
                                .done(function() { threadbit.toggleClass('lock') });
                        });

                    var report = new Report({ v: v, bb: bb, thread_id: thread.thread_id, title: thread.title })

                    recently_reported_posts['#post_'+report.target_post_id] = report.target_thread_id;

                    if ( !report.assigned ) {
                        $('&lt;a title="Click to take this thread" class="newcontent_textcontrol" rel="nofollow" href="newreply.php?t='+thread.thread_id+'&amp;noquote=1" style="float:right">Take this report&lt;/a>')
                            .click(function(event) {
                                report.take( name, false );
                                event.preventDefault();
                            })
                            .insertAfter(thread.title_element);
                    }

                    return true;
                });

            });


            /*
             * INTRODUCTIONS FORUM
             */

            dashboard.find('[data-forum="introductions"]').data( 'filter', function(threads) {
                return threads.filter(function(thread) {
                    if ( thread.is_sticky || thread.status != 'open' || thread.thread_id &lt;= stash.replied_thread_id ) return false;
                    $('.threadimod input', thread.container_element).prop( 'checked', true );
                    return true;
                });
            });

            dashboard.find('[data-monitor="forum"] .blocksubfoot input').click(function() {

                var max_thread_id = 0;

                var reply_action = new Action(
                    'welcome newbies',
                    dashboard.find('[data-forum="introductions"] .threadimod input').map(function() {
                        var reply_keys = { 'thread starter': $(this).closest('.threadbit').find('.username').first().text() };
                        var thread_id = parseInt(this.id.substr(21),10);
                        if ( max_thread_id &lt; thread_id ) max_thread_id = thread_id;
                        if ( $(this).is(':checked') ) return {
                            fire: function(keys) {
                                if ( thread_id > keys.replied_thread_id ) {
                                    return bb.thread_reply({
                                        thread_id: thread_id,
                                        title    : v.resolve('other templates', 'post title: welcome', reply_keys, 'string', introductions_forum_id),
                                        bbcode   : v.resolve('other templates',  'post body: welcome', reply_keys, 'string', introductions_forum_id)
                                    });
                                }
                            }
                        }
                    }).get()
                );

                var update_action = new Action(
                    'update shared store',
                    {
                        fire: function() {
                            return ss.transaction(function(data) {
                                stash.replied_thread_id = data.intro_forum_thread_id || 0;
                                data.intro_forum_thread_id = max_thread_id;
                                return stash.replied_thread_id != max_thread_id
                            }).then(function(data) {
                                return { keys: { replied_thread_id: stash.replied_thread_id, max_thread_id: data.intro_forum_thread_id } };
                            });
                        }
                    }
                );

                progress_bar(this, update_action.then(reply_action).fire(bb), 'welcomed!');

            });


            /*
             * ACTIVITY
             */
            dashboard.find('[data-monitor="activity"]').data( 'filter', function(posts) {
                return posts.filter(function(post) { return au.is_ours(post.thread_id, v.get_language( post.thread_id, post.forum_id )) });
            });

            /*
             * NEWBIE LIST
             */

            var newbie_policy = new NewbiePolicy({
                v : v,
                bb: bb,
                vi: vi,
                ss: ss
            });

            var update_timer = null;
            function update_actions() {

                if ( update_timer !== null ) clearTimeout(update_timer);

                update_timer = setTimeout(function() {
                    update_timer = null;
                    var title = newbie_policy.set_actions(
                        dashboard.find('.dashboard-newbies [name="issue"]:checked').map(function() { return $(this).data('action') }).get()
                    );
                    dashboard.find('.dashboard-newbies-result input').prop( 'disabled', false ).val( title || 'Validate all users' );
                }, 100 );

            }

            dashboard.find('.dashboard-newbies .dashboard-body')
                .on( 'click', 'a.collapse', function(event) {
                    $(this).closest('.options_block').toggleClass('collapsed');
                    event.stopPropagation();
                    event.preventDefault();
                })
                .on( 'click', '[name="issue"]', function() { // update when user selects an action

                    var block = $(this).closest('.options_block');

                    if ( this.value == 'valid' )
                        block.toggleClass('collapsed');
                    else
                        block.removeClass('collapsed');

                    block
                        .removeClass('valid inappropriate dupe')
                        .addClass(this.value)
                    ;

                    /*
                     * Build blocks when the user actually clicks to see them.
                     * Building this at creation time would be incredibly slow.
                     */

                    if ( this.value == 'inappropriate' &amp;&amp; !block.hasClass('inappropriate-built') ) {

                        /*
                         * Initialise the inappropriate username block
                         */

                        var user = block.data('user');

                        function update_inappropriate() {
                            if ( !extra_post ) return; // ignore the callback during construction
                            block.find('[name="issue"][value="inappropriate"]')
                                .data( 'action', newbie_policy.action_inappropriate_wrapper( extra_post, notification.action(), user ));
                            update_actions();
                        }

                        var inappropriate = block.find('.inappropriate');
                        inappropriate.find( '.search .username' ).text( user.username );
                        inappropriate.find( '.search a' ).each(function() {
                            this.href += encodeURIComponent(user.username);
                        });
                        var notification = new NotificationSelector($.extend(
                            newbie_policy.notification_selector_inappropriate(undefined, user),
                            widget_args,
                            { container: inappropriate.find('.notification') }
                        ));
                        var extra_post = new ExtraPost($.extend(
                            newbie_policy.extra_post_inappropriate(undefined, user),
                            widget_args,
                            {
                                container: notification.extra_block(),
                                callback : update_inappropriate
                            }
                        ));
                        new SeveritySlider($.extend(
                            newbie_policy.severity_slider_inappropriate(),
                            widget_args,
                            {
                                container: inappropriate.find('.posthead'),
                                callback: function(level) {
                                    notification.val(newbie_policy.notification_selector_inappropriate( level, user ));
                                    extra_post.val(newbie_policy.extra_post_inappropriate(level, user));
                                    update_inappropriate();
                                }
                            }
                        ));
                        inappropriate.find('.notification').prepend( notification.mode_switcher() );

                        block.addClass('inappropriate-built');

                    } else if ( this.value == 'dupe' &amp;&amp; !block.hasClass('dupe-built') ) {

                        /*
                         * Initialise the duplicate account block
                         */

                        var user = block.data('user');

                        var suspiciousness = newbie_policy.suspiciousness_duplicate(user);

                        var dupe_level, dupe_users = [{
                            username: user.username,
                            user_id : user.user_id,
                            email   : user.email,
                            notes   : user.summary,
                            is_primary: true,
                        }]
                            .concat(user.suspected_duplicates.map(function(user) {
                                return {
                                    username  : user.username,
                                    user_id   : user.user_id,
                                    email     : user.moderation_info.email,
                                    notes     : user.info.infraction_summary + ' ' + user.moderation_info.summary,
                                    is_banned : user.info.is_banned,
                                    is_primary: false
                                };
                            }));

                        var dupe = block.find('.dupe');
                        var dupe_action_container = dupe.find('.dupe-actions');

                        function update_dupe() {

                            var extra_post, user_actions = [];

                            dupe_action_container.empty().append(

                                dupe_users.map(function(user, index) {

                                    var element = $('&lt;fieldset class="dupe-user-action">&lt;legend>&lt;/legend>&lt;div class="notification">&lt;/div>&lt;/fieldset>');
                                    element.find('legend').text( 'User action: ' + user.username );

                                    var notification = new NotificationSelector($.extend(
                                        newbie_policy.notification_selector_duplicate(dupe_level, user, dupe_users, suspiciousness ),
                                        widget_args,
                                        { container: element.find('.notification') }
                                    ));

                                    if ( !index ) {
                                        extra_post = new ExtraPost($.extend(
                                            newbie_policy.extra_post_duplicate(suspiciousness, dupe_level, user, dupe_users),
                                            widget_args,
                                            {
                                                container: notification.extra_block(),
                                                callback : update_actions
                                            }
                                        ));
                                    }

                                    user_actions.push( notification.action() );
                                    element.find('.notification').prepend( notification.mode_switcher() );
                                    return element;
                                })
                            );

                            block.find('[name="issue"][value="dupe"]')
                                .data( 'action', newbie_policy.action_duplicate_wrapper( extra_post, user_actions, dupe_users ) );

                            update_actions();

                        };

                        new SeveritySlider($.extend(
                            newbie_policy.severity_slider_duplicate(suspiciousness),
                            widget_args,
                            {
                                container: dupe.find('.posthead'),
                                callback: function(level) {
                                    dupe_level = level;
                                    update_dupe();
                                }
                            }
                        ));
                        new DuplicateAccountList($.extend(
                            widget_args,
                            {
                                required: dupe_users.slice(0,1),
                                default : dupe_users.slice(1),
                                container: dupe.find('.dupes'),
                                callback: function(u) {
                                    dupe_users = u;
                                    update_dupe();
                                }
                            }
                        ));

                        block.addClass('dupe-built');

                    }

                    update_actions();

                })
            ;

            var min_user_id, max_user_id;

            dashboard.find('.dashboard-newbies .dashboard-newbies-result input').click(function() {
                progress_bar(this, newbie_policy.fire( min_user_id, max_user_id, dashboard.find( '.dashboard-newbies [name="extra-notes"]' ).val() ), 'validated!');
            });

            var widget_args = {
                v               : v,
                bb              : bb,
                violations      : vi,
                violation_groups: mc.violation_groups,
                loading_html    : loading_html,
            };

            dashboard.find('[data-monitor="newbies"]').data( 'min_user_id', function(users) { return newbie_policy.get_base_user_id() });

            dashboard.find('[data-monitor="newbies"]').data( 'filter', function(users) {

                var previous_users = {};

                min_user_id = Infinity;
                max_user_id = 0;

                // Need to fire this after the elements have been inserted into the DOM:
                setTimeout(function() {
                    dashboard.find('[data-monitor="newbies"] time').timeago();
                    update_actions();
                }, 0 );

                return users.filter(function(user) {

                    if ( min_user_id > user.user_id ) min_user_id = user.user_id;
                    if ( max_user_id &lt; user.user_id ) max_user_id = user.user_id;

                    /*
                     * Initialise the basic interface.
                     * Specific blocks are initialised if and when they become visible
                     */

                    user.element.data( 'username', user.username );
                    user.element.data( 'user_id', user.user_id );
                    user.element.data( 'user', user );

                    user.element.find('h4 .title').text( user.username );

                    if ( previous_users.hasOwnProperty(user.user_id) ) {
                        user.element.find('[name="issue"][value="valid"]').first().prop( 'checked', true );
                    } else if ( user.suspected_duplicates.length ) {
                        var element =
                            user.element.removeClass('collapsed')
                            .find('.valid')
                            .html('Suspected additional accounts for &lt;a>&lt;/a> &amp;lt;&lt;a>&lt;/a>&amp;gt;: &lt;ul>&lt;/ul>&lt;a href="">See IP address report for &lt;span>&lt;/span>&lt;/a> (only finds users with overlapping post addresses)')
                        ;
                        var anchors = element.find('a');
                        anchors.eq(0)
                            .attr( 'href', bb.url_for.user_show({ user_id: user.user_id }) )
                            .text( user.username );
                        anchors.eq(1)
                            .attr( 'href', 'mailto:' + user.email )
                            .text( user.email );
                        anchors.eq(2)
                            .attr( 'href', bb.url_for.moderation_ipsearch({ username: user.username, depth: 2 }) )
                            .find('span').text( user.username );
                        var highlighter = new EmailHighlighter({ v: v, source_address: user.email });
                        element
                            .children('ul')
                            .append(
                                user.suspected_duplicates.map(function(user) {
                                    var element = $('&lt;li>&lt;a>&lt;/a> &amp;lt;&lt;a>&lt;span>&lt;/span>@&lt;span>&lt;/span>&lt;/a>&amp;gt; &lt;span>&lt;/span>&lt;/li>')
                                    element.find('a').first()
                                        .attr( 'href', bb.url_for.user_show({ user_id: user.user_id }) )
                                        .text( user.username );
                                    var email_element = element.find('a').last()
                                        .attr( 'href', 'mailto:' + user.moderation_info.email );
                                    highlighter.highlight_to_element(
                                        user.moderation_info.email,
                                        email_element.children().eq(0),
                                        email_element.children().eq(1)
                                    );
                                    element.children().last().html(
                                        user.info.infraction_summary + ' ' + user.moderation_info.summary
                                    );
                                    return element;
                                })
                            );
                        user.suspected_duplicates.forEach(function(user) { previous_users[user.user_id] = true });
                    }

                    previous_users[user.user_id] = true;

                    return true;

                });

            });


            /*
             * INITIALISE
             */

            // log in to ModCP before loading the dashboard (which will then keep us logged in)
            body_wrapper = $('.body_wrapper').html( '&lt;iframe style="margin:auto">&lt;/iframe>' );
            bb.moderation_page( body_wrapper.find('iframe'), '/modcp/index.php?do=nav', '.navlink', '.navlink' ).then(function() {

                document.title = 'Dashboard';
                body_wrapper.empty().append(dashboard);
                new Dashboard({
                    cache        : JSON.parse( dashboard_cache || '{}' ),
                    cache_updater: function(cache) { BabelExt.storage.set( 'dashboard_cache', JSON.stringify( cache ) ) },
                    container: body_wrapper,
                    interval : 60000,
                    bb       : bb,
                    v        : v
                });

            });

        })}
    },

    {
        match_elements: '#globalsearch',
        pass_storage: ['dashboard_cache'],
        callback: function( stash, pathname, params, below_body, dashboard_cache ) {
            // Add "Dashboard" link to nav tab on all pages
            $('&lt;li>&lt;a class="navtab" href="/?do=dashboard">Dashboard&lt;/a>&lt;/li>').appendTo('#navtabs');
        }
    }

)}

/**
 * @summary Handle variables threads
 * @param {BulletinBoard} bb Bulletin Board to manipulate
 * @param {Variables}     v  Variables to use
 */
function handle_variables_thread( bb, v ) { BabelExt.utils.dispatch(
    {
        match_pathname: '/showthread.php',
        match_elements: [ '#breadcrumb .navbit a[href="forumdisplay.php?f=70"]', '#below_postlist' ],
        callback: function(stash, pathname, params) {

            // edit the first post to explain what's going on, and to recommend bumping:
            var post = bb.post_create(
                'Message from the moderation tools...',
                'Moderation tools',
                'Browser extension',
                'How to edit a variables thread',
                BabelExt.resources.get('res/variables_thread_post.html')
            );
            post.find('a.newcontent_textcontrol').click(function(event) {
                bb.thread_bump(params.t).then(function() {
                    alert('thread bumped');
                });
                event.preventDefault();
            });
            $('#posts').prepend(post);

            // Refresh variables:
            v.refresh_thread(params.t, document.body)
                .then(function() { alert('The extension has refreshed the variables in this thread.\nReload any open pages to get the new values.') });

            // When a post is updated, refresh the thread and offer to bump it:
            bb.on_posts_modified(function(modifications) {
                if ( modifications.initialised.length ) {
                    v.refresh_thread(params.t, document.body)
                        .then(function() {
                            if ( confirm("The extension has refreshed the variables in this thread.\nWould you like to bump the thread so others can see the changes?") )
                                bb.thread_bump(params.t).then(function() {
                                    alert('thread bumped');
                                });
                        });
                }
            });

        }
    }
)}

/**
 * @summary Handle threads where a form should be provided to produce replies
 */
function handle_thread_form( bb, v, error_callback ) {
    function handle_form(editor, name, thread_id) {
        var post_var = new VariablesFromFirstPost({
            bb: bb,
            thread_id: thread_id,
            namespace: 'post',
            cache_updater: function() {},
            error_callback: error_callback
        });
        form_keys( bb, $(BabelExt.resources.get('res/' + name + '.html')).insertBefore(editor), function(keys) {
            post_var.promise.then(function() {
                bb.editor_set( post_var.resolve( 'post', 'recommended reply format', keys ) );
            });
            return false; // prevent form submission
        });
    }

    var dispatchers = [];
    [
        'Moderation Chase-Up Thread',
        'Account Merge Request Thread',
        'Name Change Request Thread'
    ].forEach(function(thread) {
        var thread_id = v.resolve( 'frequently used posts/threads', thread );
        BabelExt.utils.dispatch(
            {
                match_pathname: ['/newreply.php'],
                match_elements: [ '.description a[href="showthread.php?t=' + thread_id + '"]', '#vB_Editor_001' ],
                callback: function(stash, pathname, params, a, editor) { handle_form( editor, thread, thread_id ) }
            },
            {
                match_pathname: ['/showthread.php'],
                match_elements: [ 'link[rel="canonical"][href="showthread.php?t=' + thread_id + '"]', '#vB_Editor_QR' ],
                callback: function(stash, pathname, params, a, editor) { handle_form( editor, thread, thread_id ) }
            }
        );
    });

}

/**
 * @summary CC user notes to other users
 */
function handle_usernotes_cc( bb ) { BabelExt.utils.dispatch(
    {
        match_pathname: ['/usernote.php'],
        match_elements: ['#vB_Editor_001'],
        callback: function(stash, pathname, params, editor) {
            var cc = null;
            $(document.body).on( 'submit', '.vbform.block', function(event) {
                if ( cc ) {
                    var form = this, title = $('#titlefield').val(), bbcode = bb.editor_get();
                    $.when.apply( $, cc.map(function(user_id) { bb.usernote_add( user_id, title, bbcode ) }) ).then(function() {
                        cc = null;
                        $(form).submit();
                    });
                    event.preventDefault();
                }
            });
            form_keys( bb, $(BabelExt.resources.get('res/usernotes_cc.html')).insertBefore(editor), function(keys) {
                cc = keys[ 'cc values' ];
            });
        }
    }
)}

/**
 * @summary Handle "edit post" pages
 * @param {BulletinBoard} bb Bulletin Board to manipulate
 */
function handle_post_edit( bb ) { BabelExt.utils.dispatch(
    {
        match_pathname: ['/editpost.php'],
        match_elements: ['#deltype_soft'],
        callback: function(stash, pathname, params, button) {
            $(button).parent().css({ width: '400px' }).append( ' (recommended)' );
        }
    },

    {
        match_pathname: ['/showthread.php'],
        match_elements: [ '#below_postlist' ],
        callback: function(stash, pathname, params, button) {
            bb.on_posts_modified(function(modifications) {
                if ( modifications.edited.length ) {
                    $('#deltype_soft').prop( 'checked', true )
                        .parent().css({ width: '400px' }).append(' (recommended)');
                }
            });
        }
    }


)}

/**
 * @summary Handle moderation checkboxes
 * @description (so you can always tab through them, and hovering over tells you so)
 */
function handle_moderation_checkboxes() { BabelExt.utils.dispatch(
    {
        match_pathname: [ '/showthread.php', '/search.php', '/forumdisplay.php' ],
        callback: function(stash) {
            $(function() {
                $('.postimod,[name^=imodcheck]').attr( 'title', 'press tab then space to select the next item' );
                var highest_tab_index = Math.max.apply( Math, $('[tabindex]').map(function() { return parseInt( $(this).attr('tabindex'), 10 ) }).get() );
                $('.postimod').each(function() {
                    $(this).attr( 'tabindex', ++highest_tab_index );
                });
            });
        }
    }
)}

/**
 * @summary Handle "user" pages in ModCP
 */
function handle_modcp_user() { BabelExt.utils.dispatch(
    {
        match_pathname: '/modcp/user.php',
        match_params: {
            'do': 'viewuser'
        },
        match_elements: '.normal',
        callback: function(stash, pathname, params, normal) {
            $(normal).after( ' - &lt;a href="/member.php?u='+params.u+'">go to member page&lt;/a> - &lt;a href="/private.php?do=newpm&amp;u=' + params.u + '">send PM&lt;/a>' );
        }
    }
)}

/**
 * @summary Make it possible to share IP search URLs
 */
function handle_modcp_doips( bb ) {
    BabelExt.utils.dispatch(
        { match_pathname: '/modcp/user.php', match_params: { do: 'doips', ipaddress: true , username: false }, callback: function(s, p, params) { bb.redirect_modcp_ipsearch(params) } },
        { match_pathname: '/modcp/user.php', match_params: { do: 'doips', ipaddress: false, username: true  }, callback: function(s, p, params) { bb.redirect_modcp_ipsearch(params) } }
    );
}

/**
 * @summary Link to Moderated Posts page from moderation links
 */
function handle_moderation_links() {
    $(function(){$('img[src="images/misc/moderated.gif"],img[src="images/misc/moderated_small.gif"]').wrap('&lt;a href="/modcp/moderate.php?do=posts">&lt;/a>')});
}

/*
 * MAIN BLOCK (not run in iFrames)
 */
if (window.location == window.parent.location) BabelExt.utils.dispatch({ // initialise general stuff
    pass_storage    : ['variables', 'violations', 'misc'],
    pass_preferences: [ 'language', 'reload_interval' ],
    callback: function( stash, pathname, params, variables, violations, misc, user_language, reload_interval ) {

        var bb = new VBulletin();

        /*
         * ERROR HANDLER
         */
        var maintainer_user_id = 18617, maintainer_name = 'Andrew Sayers';

        var handle_error_box = $(BabelExt.resources.get('res/error_box.html'));
        $(function() {
            handle_error_box.appendTo(document.body);
            $('&lt;a id="debug-log-show" href="#debug-log-show">(click here to show the moderators\' extension debug log)&lt;/a>')
                .appendTo('#footer_morecopyright')
                .before('&lt;br>')
                .click(function(event) {
                    debug_log.show();
                    $(this).hide();
                    event.preventDefault();
                });
        });
        handle_error_box.find('a[href="#close-error-box"]').click(function(event) {
            handle_error_box.hide();
            event.preventDefault();
        });
        handle_error_box.find('a[href="#pm-maintainer"]').click(function(event) {
            bb.pm_send( maintainer_name, 'Debug log', debug_log.text() ).then(
                function() {
                    alert("PM sent :)");
                },
                function() {
                    alert("Could not send message.  Please copy the text area at the bottom of the page to " + maintainer_name);
                });
            event.preventDefault();
        });
        var previous_errors = {};

        function handle_error( message, resolutions ) {

            debug_log.log( message, resolutions )
            debug_log.show();
            $("#debug-log-show").hide();

            if ( !$.isArray(resolutions) ) resolutions = [resolutions];
            resolutions = resolutions.map(function(resolution) {
                switch (resolution) {
                case 'log in':
                    if ( bb.user_current() ) {
                        return { message: 'Contact the maintainer', href: '/private.php?do=newpm&amp;u=' + maintainer_user_id };
                    } else {
                        return {
                            message: 'log in',
                            href   : bb.url_for.login(),
                        };
                    }
                default: return resolution;
                }
            });

            // ignore duplicate messages:
            if ( previous_errors[message] ) return;
            previous_errors[message] = true;

            var row = $('&lt;tr>&lt;td>&lt;td style="padding-left: 1em">&lt;/tr>').appendTo(handle_error_box.find('tbody'));
            row.children('td').first().text( message );
            row.children('td'). last().html(
                ( resolutions || [] ).map(function(resolution) {
                    return $('&lt;a>').text( resolution.message ).attr( 'href', resolution.href );
                })
            ).children(':not(:last-child)').after(', ');
            $(function() { handle_error_box.show() });

        }

        $( document ).ajaxError(function debug_ajax_errors( event, xhr, settings, error ) {
            var messages = [];
            try {
                messages.push( error );
                messages.push( settings );
                messages.push( event );
                messages.push( xhr.status );
                messages.push( xhr.statusText );
                messages.push( xhr.getAllResponseHeaders() );
                messages.push( xhr.responseText );
            } catch (error) {  messages.push('caught error while adding values:', error); };
            debug_log.log.apply( debug_log, messages );
        });

        /*
         * GENERAL VARIABLES
         */

        var loading_img  = '&lt;img src="images/misc/progress.gif" alt="loading, please wait">';
        var loading_html = loading_img + ' Loading';

        var next_week = new Date();
        next_week.setDate(next_week.getDate()+7);

        function cacheable_args(cache, name, args) {
            return $.extend({
                bb             : bb,
                cache          : JSON.parse( cache || '{}' ),
                cache_updater  : function(cache) { BabelExt.storage.set( name, JSON.stringify( cache ) ) },
                reload_interval: reload_interval * 1000,
                error_callback : handle_error,
            }, args );
        }

        var v = new VariablesFromForum(cacheable_args( variables, 'variables', {
            forum_id        : 70,
            default_language: user_language,
            default_keys    : {
                origin     : location.origin,
                'next week': next_week.toUTCString().replace(/:[0-9][0-9] /, ' ' )
            }
        }));

        v.promise.then(function() { return handle_variables_thread( bb, v ) }).then(function() {

            var shared_store_note_id = v.resolve( 'policy', 'shared store note ID' );
            var ss = new SharedStore({
                lock_url: v.resolve( 'policy', 'shared store lock URL' ),
                store   : function(data) {
                    return bb.usernote_edit(
                        shared_store_note_id,
                        'Shared store for moderator actions - do not edit', "Do not edit this note.  It is managed automatically by the moderators' extension.\n\n" +
                        '[code]' + data + '[/code]'
                    );
                },
                retrieve: function() {
                    return bb.usernote_info(
                        shared_store_note_id
                    ).then(function(info) {
                        var ret = null;
                        info.bbcode.replace( /\[code\](.*)\[\/code\]$/, function(match,data) { ret = data });
                        return ret;
                    });
                }
            });

            bb.config({
                'unPMable user groups': v.resolve( 'policy', 'unpmable user groups', undefined, 'array of items' ).map(function(g) { return g.value }),
                'default user group'  : v.resolve( 'policy', 'default user group' )
            });

            var vi = new Violations(cacheable_args( violations, 'violations', {
                v: v,
                default_user_action: 'warning',
            }));

            var mc = new MiscellaneousCache(cacheable_args( misc, 'misc', {
                v : v,
                vi: vi
            }));

            $.when( vi.promise, mc.promise ).then(function() {
                handle_modcp_doips          ( bb );
                handle_post_edit            ( bb );
                handle_moderation_links     ();
                handle_moderation_checkboxes();
                handle_modcp_user           ();
                handle_thread_form          ( bb, v, handle_error );
                handle_usernotes_cc         ( bb, v );
                handle_dashboard            ( bb, v, vi, ss, mc, loading_html );
                handle_legacy               ( bb, v, vi, loading_html ); // everything that hasn't been refactored yet
            });

        });

    }

});
</code></pre>
        </article>
    </section>








        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-beta1</a> on 22 April 2015
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
